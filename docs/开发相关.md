
# 植物僵尸动画
使用[R2Ga_PVZ](#r2ga_pvz)将植物大战僵尸的动画文件转换为Godot游戏引擎所支持的动画格式。

僵尸动画：使用插件[anim_delet_track](#anim_delet_track)将不需要的的轨道删除，主要是删除删除僵尸胳膊和头相关的visible轨道，僵尸掉手或掉头时使用代码控制visible。

植物动画：植物射击时眨眼和idle时眨眼节点不同，由于射击时眨眼动画需要使用visible轨道，使用插件[anim_player_refactor](#anim_player_refactor)将idle时的眨眼节点visible轨道删除，使用代码控制植物眨眼。


# 子弹攻击碎片溅射
- 创建GPUParticles2D
- texture(GPUParticles2D) 添加子弹碎片图集
- material(CnavasItem) 添加CanvasItemMaterial
	- 修改对应的articles_anim_h_frames和particles_anim_v_frames
- process_material(GPUParticles2D) 添加ParticleProcessMaterial
	- 修改Display-Animation-Offset
- 修改粒子特效相关属性（初始方向，重力加速度，时间缩放）

# 碰撞层相关
- layer 1 	World : 世界层，房子区域碰撞使用该层，TODO: 泳池也会改到这个层（可能），僵尸不检测，房子检测僵尸
- layer 2 Plant : 植物层，大部分植物所在层（非地刺），
- layer 3 Zombie : 僵尸层，僵尸正常状态（非潜水、非空中、非矿工掘地等），
- layer 4 Bullet : 子弹层，子弹所在层，
- layer 5 ZombieInJump : 僵尸跳跃层，撑杆跳跳跃、海豚跳跃，
- layer 6 ZombieBeHypnotized : 僵尸被魅惑层，被魅惑僵尸改变至该层，植物子弹检测不到，
- layer 7 Bowling : 保龄球子弹层，撑杆跳僵尸可以检测到该层跳跃，
- layer 8 Pool : 泳池层，僵尸检测到该层下水，TODO：改到世界层（可能）
- layer 9 Caltrop : 地刺层，普通僵尸检测不到该层，冰车可以，巨人可以，
- layer 10 UpBulletPlant : 升级子弹植物层，子弹检测该层，升级子弹，
- layer 11 ZombieInPoolDown : 僵尸潜水层，潜水僵尸潜水后改变，子弹和普通植物检测不到，缠绕海草可以检测
- layer 12 ZombieInSky : 气球僵尸在空中层
- layer 13 ZombieInGroundDown : 矿工僵尸掘地时所在层



# 植物种植相关
植物位置有四种: `float(漂浮植物:咖啡豆)、down(底部植物:花盆、睡莲)、norm(正常普通植物：豌豆射手)、shell(壳类植物：南瓜头)`  
地形分为6种（植物格子为某一种类型+“无”类型）：`"1 无", "2 草地", "4 花盆", "8 水", "16 睡莲", "32 屋顶/裸地"`

植物种植的地形可以为多种，如豌豆射手：`22 = 2(草地) + 4(花盆)+ 16(睡莲)`  
植物的位置属性只能选一种  
每个植物的种植条件使用自定义资源（`ResourcePlantCondition`），相同的种植条件可以使用同一个资源  
种植条件资源需要保存在`res://resources/plant_resource/plant_condition/`目录下  


植物格子（`PlantCell类`）管理当前格子的植物  
普通植物种植时需同时满足当前植物格子空闲位置和地形才可以种植  
特殊植物需继承种植资源脚本重写判断函数判断是否可以种植  

植物格子有每个位置对应的植物容器作为种植植物的父节点  
原始PlantCell节点如下：
- PlantCell (PlantCell)
  - PlantDownContainer (Node2d)
  - PlantFloatContainer (Node2d)
  - PlantNormContainer (Node2d)
  - PlantShellContainer (Node2d)

本项目norm和shell位置的植物可以跟随down的植物上下移动（原版花盆种植植物后就不动了，我写完才发现，就这样了）  
down位置植物需要容器节点（DownPlantSelfContainer）作为norm和shell位置植物的父节点，down位置植物移动容器节点从而带动norm和shell位置植物移动（使用动画或tween控制移动）  
种植down位置植物时将植物格子的norm和shell位置的容器节点作为down位置植物的容器节点的子节点。  
down位置植物节点如下：
- DownPlant(Plant)
	- DownPlantSelfContainer(Node2D)
	- DownPlantOtherNode

种植底部植物后如下所示
- PlantCell (PlantCell)
  - PlantDownContainer (Node2d)
	- DownPlant(Plant)
		- DownPlantSelfContainer(Node2D)
			- DownPlantOtherNode
			- PlantFloatContainer (Node2d)
			- PlantNormContainer (Node2d)
  - PlantShellContainer (Node2d)


## 可能踩的坑
- 1、植物需要对应的种植条件资源文件，植物节点本身需要添加该资源文件，同时需要再global脚本中更新对应的PlantInfo
- 2、静态迷雾_ready()函数中会调用init_static_fog()初始化静态迷雾，会删除`
@export var del_fog_postion_area:Vector2 = Vector2(650, 700)`之外的静态迷雾,如果修改屏幕显示大小，需修改该参数适应屏幕
- 3、花园窝瓜动画和主游戏窝瓜动画不同，主游戏窝瓜动画有body节点，花园窝瓜没有，如果相同，窝瓜会飘在空中


# 插件
## [anim_player_refactor](https://github.com/poohcom1/godot-animation-player-refactor)  
一个 Godot 插件，用于重构 AnimationPlayer 的动画。
[插件使用教程](https://www.bilibili.com/video/BV1GxXWYZExH?spm_id_from=333.788.videopod.sections&vd_source=1005534986b111b7c1911fe1c36ac835)

注意：目录下**plugin.gd**脚本中调用的函数EditorUtil.find_animation_menu_button(base_control)只支持英文，需要进入函数修改对应的代码 func(node): return node.text == "Animation" 修改为 func(node): return node.text == "Animation" or node.text == "动画" 

## [R2Ga_PVZ](https://github.com/hsk-dream/PVZ_reanim2godot_animation)
将植物大战僵尸的动画文件转换为Godot游戏引擎所支持的动画格式。[使用教程](https://www.bilibili.com/video/BV1XBKwzdELA/)  
forked from [PVZ_reanim2godot_animation](https://github.com/HYTommm/PVZ_reanim2godot_animation)

## [anim_delet_track](https://github.com/hsk-dream/anim_delet_track)
Godot插件，一键删除目录下所有动画资源文件的被选择轨道。 [使用教程](https://www.bilibili.com/video/BV1XBKwzdELA/)  
